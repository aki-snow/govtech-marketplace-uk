

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>AWS accounts and access &mdash; digitalmarketplace-manual 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="AWS Resources" href="aws-resources.html" />
    <link rel="prev" title="The Antivirus API" href="antivirus.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> digitalmarketplace-manual
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Digital Marketplace background</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../digital-marketplace-background/deportalising.html">History: From G-Cloud 5 to G-Cloud 8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../digital-marketplace-background/finding-things.html">Finding Things</a></li>
<li class="toctree-l1"><a class="reference internal" href="../digital-marketplace-background/journeys.html">User Journeys on the Digital Marketplace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../digital-marketplace-background/gdpr.html">GDPR</a></li>
</ul>
<p class="caption"><span class="caption-text">Developing the Digital Marketplace</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/accessing-the-api.html">Accessing the API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/adding-repos.html">Adding a new repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/application-architecture.html">Application architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/browser-support.html">Browser and accessibility support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/environments.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/developer-setup.html">Developer setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/decision-records.html">Recording decisions on the Digital Marketplace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/digitalmarketplace-runner.html">Digital Marketplace Runner (‘dmrunner’)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/nix.html">Nix Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/data-model.html">Data model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/development-and-deployment-process.html">Development and deployment process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/frontend-migration.html">Migrating the Digital Marketplace frontend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/moving-data.html">Moving data between environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/urls.html">URLs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/users.html">Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/google-analytics.html">Google Analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/load-testing.html">Load testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/automated-testing.html">Automated testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/splitting-applications.html">Splitting or adding a frontend application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/database-migrations.html">Database migrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/docker-strategies.html">Docker strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/frontend-assets-and-tools.html">Frontend assets and tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/python-typing-strategy.html">Python typing strategy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/production-guidelines.html">Guidelines for accessing production data and systems</a></li>
</ul>
<p class="caption"><span class="caption-text">Content and frameworks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/adding-frameworks.html">Preparing to add a new framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/framework-lifecycle-for-developers.html">Framework lifecycle for developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/how-suppliers-apply-to-a-framework.html">How suppliers apply to a framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/framework-agreements.html">Framework agreements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/contract-variations.html">Contract variations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/adding-a-new-form-field-type.html">Adding a new form field type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/finding-content.html">Finding content</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/changing-content.html">Changing content</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/useful-api-endpoints-for-frameworks.html">Useful API endpoints for frameworks</a></li>
</ul>
<p class="caption"><span class="caption-text">Infrastructure</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="antivirus.html">The Antivirus API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">AWS accounts and access</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#accounts">Accounts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Main</a></li>
<li class="toctree-l3"><a class="reference internal" href="#development-and-production">Development and Production</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Backups</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#aws-console-access">AWS Console Access</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#logging-in-for-the-first-time">Logging in for the first time</a></li>
<li class="toctree-l3"><a class="reference internal" href="#switching-roles-to-access-other-accounts">Switching roles (to access other accounts)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#programmatic-access">Programmatic access</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generating-access-keys">Generating access keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="#storing-your-access-keys">Storing your access keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="#available-roles">Available roles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-profiles">Using profiles</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#billing-and-billing-alerts">Billing and billing alerts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="aws-resources.html">AWS Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-backups.html">Code backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="database-backups.html">Database backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="domains.html">Domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="emails.html">Email integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="elasticsearch.html">Elasticsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="jenkins.html">Jenkins</a></li>
<li class="toctree-l1"><a class="reference internal" href="github-actions.html">GitHub Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging, monitoring and alerting</a></li>
<li class="toctree-l1"><a class="reference internal" href="maintenance-mode.html">Maintenance Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="python-environments.html">Python environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="paas.html">What is PaaS?</a></li>
<li class="toctree-l1"><a class="reference internal" href="paas.html#deploying-digital-marketplace-apps-to-gov-uk-paas">Deploying Digital Marketplace apps to GOV.UK PaaS</a></li>
<li class="toctree-l1"><a class="reference internal" href="rate-limiting.html">Rate Limiting</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrading-backend-services.html">Upgrading backend services</a></li>
<li class="toctree-l1"><a class="reference internal" href="session-management.html">Session Management</a></li>
</ul>
<p class="caption"><span class="caption-text">Managing People and Secret Things</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../managing-people-and-secret-things/credentials.html">Credentials and secrets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../managing-people-and-secret-things/accounts.html">Adding and removing access for new starters / leavers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../managing-people-and-secret-things/production-access.html">Requirements for access to production environments</a></li>
</ul>
<p class="caption"><span class="caption-text">2nd Line Runbook</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/incidents.html">Incidents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/logging-in-to-paas-databases.html">Logging in to databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/logging-in-to-paas-databases.html#resetting-brief-data-with-conduit">Resetting brief data with conduit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/blocking-ips.html">IP Restrictions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/upgrading-jenkins.html">Upgrading Jenkins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/rebuilding-jenkins.html">Rebuilding Jenkins from scratch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/rotate-keys.html">Rotating API keys</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/debugging-paas-app-instances.html">Debugging PaaS App Instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/vulnerability-scanning.html">Vulnerability scanning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/novations.html">Novations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/support-tasks.html">Support Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/investigating-alerts.html">Responding to Cloudwatch alerts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/buyer-domain-allow-list.html">Buyer Domain Allow List</a></li>
</ul>
<p class="caption"><span class="caption-text">What is this?</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/alphagov/digitalmarketplace-manual/blob/master/README.md">README</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">digitalmarketplace-manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>AWS accounts and access</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/Crown-Commercial-Service/digitalmarketplace-manual/blob/main/manual/infrastructure/aws-accounts.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="aws-accounts-and-access">
<span id="aws-accounts"></span><h1><a class="toc-backref" href="#id7">AWS accounts and access</a><a class="headerlink" href="#aws-accounts-and-access" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#aws-accounts-and-access" id="id7">AWS accounts and access</a></p>
<ul>
<li><p><a class="reference internal" href="#accounts" id="id8">Accounts</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id9">Main</a></p></li>
<li><p><a class="reference internal" href="#development-and-production" id="id10">Development and Production</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id11">Backups</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#aws-console-access" id="id12">AWS Console Access</a></p>
<ul>
<li><p><a class="reference internal" href="#logging-in-for-the-first-time" id="id13">Logging in for the first time</a></p></li>
<li><p><a class="reference internal" href="#switching-roles-to-access-other-accounts" id="id14">Switching roles (to access other accounts)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#programmatic-access" id="id15">Programmatic access</a></p>
<ul>
<li><p><a class="reference internal" href="#generating-access-keys" id="id16">Generating access keys</a></p></li>
<li><p><a class="reference internal" href="#storing-your-access-keys" id="id17">Storing your access keys</a></p></li>
<li><p><a class="reference internal" href="#available-roles" id="id18">Available roles</a></p></li>
<li><p><a class="reference internal" href="#using-profiles" id="id19">Using profiles</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#billing-and-billing-alerts" id="id20">Billing and billing alerts</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For information on how permissions are granted within accounts see the <a class="reference internal" href="aws-resources.html#iam"><span class="std std-ref">IAM</span></a> section of the <a class="reference internal" href="aws-resources.html#aws-resources"><span class="std std-ref">AWS Resources</span></a> page.</p>
</div>
<div class="section" id="accounts">
<h2><a class="toc-backref" href="#id8">Accounts</a><a class="headerlink" href="#accounts" title="Permalink to this headline">¶</a></h2>
<p>There are currently four AWS accounts we use:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://digitalmarketplace.signin.aws.amazon.com/console">main</a>: the main account for globally utilised AWS infrastructure</p></li>
<li><p><a class="reference external" href="https://digitalmarketplace-development.signin.aws.amazon.com/console">development</a>: used for local development and the preview environment</p></li>
<li><p><a class="reference external" href="https://digitalmarketplace-production.signin.aws.amazon.com/console">production</a>: staging and production environments</p></li>
<li><p><a class="reference external" href="https://digitalmarketplace-backups.signin.aws.amazon.com/console">backups</a>: s3 bucket containing nightly db backups</p></li>
</ul>
</div></blockquote>
<p>The login email addresses for the root users of these accounts are listed in the credentials repo in the <code class="docutils literal notranslate"><span class="pre">logins.enc</span></code>
file. In general, and following <a class="reference external" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html">best practices</a>, these root users are never normally used. As
such, we don’t store the passwords for them. If you need to login as a root user you should trigger a password reset.
The MFA codes for the accounts are distributed among various team members.</p>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id9">Main</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The main account is used for creating objects that are not direct attributes of an environment.</p>
<p>For example our Jenkins EC2 instance is environmentally agnostic because it has jobs that operate on preview, jobs that operate on staging and production, and jobs that operate freely of any DM environment.
Our AWS users are actually environmentally agnostic too. They should be able to access the different environments. But they are not tied to one or the other.</p>
<p>As well as the Jenkins EC2 and our aws users, other AWS objects we create in the main account are:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://github.com/mozilla/sops">SOPS</a> AWS KMS keys (for decrypting the credentials in the credentials repo)</p></li>
<li><p>Route53 DNS apex records for the marketplace.team DNS zone</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="development-and-production">
<h3><a class="toc-backref" href="#id10">Development and Production</a><a class="headerlink" href="#development-and-production" title="Permalink to this headline">¶</a></h3>
<p>The Development account houses the infrastructure related to the preview
environment of Digital Marketplace.</p>
<p>The Production account houses the infrastructure related to the staging and
production environment of Digital Marketplace.</p>
<p>These include; Route53 DNS records for subdomains (e.g. www), S3 buckets, dedicated users for handling logging, cloudwatch log
groups, and IAM policies that allow users from the <em>main</em> account to operate on
objects in the Development and Production accounts.</p>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id11">Backups</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The backups account houses two S3 buckets that contain encrypted and compressed
copies of our database. For more on how they get there see the <a class="reference internal" href="database-backups.html#the-s3-buckets"><span class="std std-ref">backups
section</span></a> of the manual.</p>
<p>A separate account is necessary because it is impossible to have MFA delete
<em>and</em> a lifecycle deletion policy on the same bucket.  To get around this we
created an entirely new account protected by MFA, containing a bucket with a
lifecycle deletion policy.</p>
<p>To access the backups account, for example to run Terraform, you will need to reset the root password and generate IAM credentials. Before doing this notify <a class="reference external" href="https://gds.slack.com/archives/CCMPJKFDK">#cyber-security-help</a> as they will receive an alert about the password reset.</p>
</div>
</div>
<div class="section" id="aws-console-access">
<h2><a class="toc-backref" href="#id12">AWS Console Access</a><a class="headerlink" href="#aws-console-access" title="Permalink to this headline">¶</a></h2>
<p>All users have access to the main AWS account. Using the <a class="reference external" href="https://console.aws.amazon.com">AWS console</a> is IP
restricted (GDS office IPS) and MFA is mandatory. Other accounts can be
accessed by switching roles.</p>
<div class="section" id="logging-in-for-the-first-time">
<h3><a class="toc-backref" href="#id13">Logging in for the first time</a><a class="headerlink" href="#logging-in-for-the-first-time" title="Permalink to this headline">¶</a></h3>
<p>All passwords have to comply with the following rules:</p>
<blockquote>
<div><ul class="simple">
<li><p>at least 12 characters long</p></li>
<li><p>contains at least one uppercase letter</p></li>
<li><p>contains at least one lowercase letter</p></li>
<li><p>contains at least one number</p></li>
</ul>
</div></blockquote>
<p>You can set up MFA the following way:</p>
<blockquote>
<div><ul class="simple">
<li><p>IAM -&gt; Users -&gt; [your user] -&gt; Security credentials tab -&gt; Assigned MFA device -&gt; edit</p></li>
<li><p>After adding the MFA device you need to log out and log in again to have access to the services you are allowed to manage</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="switching-roles-to-access-other-accounts">
<span id="switching-roles"></span><h3><a class="toc-backref" href="#id14">Switching roles (to access other accounts)</a><a class="headerlink" href="#switching-roles-to-access-other-accounts" title="Permalink to this headline">¶</a></h3>
<p>You can switch roles by clicking on the top right on the &lt;username&gt;&#64;account menu and choosing the ‘Switch Role’ action. You’ll also find the last several roles you used in there.</p>
<p>Available roles:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://signin.aws.amazon.com/switchrole?account=digitalmarketplace-development&amp;roleName=admins&amp;displayName=DM%20Admin%20-%20Dev">Admin in development account</a></p></li>
<li><p><a class="reference external" href="https://signin.aws.amazon.com/switchrole?account=digitalmarketplace-production&amp;roleName=admins&amp;displayName=DM%20Admin%20-%20Prod">Admin in production account</a></p></li>
<li><p><a class="reference external" href="https://signin.aws.amazon.com/switchrole?account=digitalmarketplace&amp;roleName=admins&amp;displayName=DM%20Admin%20-%20Main">Admin in main account</a></p></li>
<li><p><a class="reference external" href="https://signin.aws.amazon.com/switchrole?account=digitalmarketplace-backups&amp;roleName=backups&amp;displayName=DM%20Backups">Backups in backups account</a></p></li>
<li><p><a class="reference external" href="https://signin.aws.amazon.com/switchrole?account=digitalmarketplace-development&amp;roleName=developers&amp;displayName=DM%20Developer%20-%20Dev">Developer in development account</a></p></li>
<li><p><a class="reference external" href="https://signin.aws.amazon.com/switchrole?account=digitalmarketplace-production&amp;roleName=developers&amp;displayName=DM%20Developer%20-%20Prod">Developer in production account</a></p></li>
<li><p><a class="reference external" href="https://signin.aws.amazon.com/switchrole?account=digitalmarketplace-development&amp;roleName=infrastructure&amp;displayName=DM%20Infrastructure%20-%20Dev">Infrastructure in development account</a></p></li>
<li><p><a class="reference external" href="https://signin.aws.amazon.com/switchrole?account=digitalmarketplace-production&amp;roleName=infrastructure&amp;displayName=DM%20Infrastructure%20-%20Prod">Infrastructure in production account</a></p></li>
<li><p><a class="reference external" href="https://signin.aws.amazon.com/switchrole?account=digitalmarketplace&amp;roleName=infrastructure&amp;displayName=DM%20Infrastructure%20-%20Main">Infrastructure in main account</a></p></li>
</ul>
</div></blockquote>
<p>If needed you can construct a switch role url in the following format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://signin.aws.amazon.com/switchrole?account=&lt;account_id_number&gt;&amp;roleName=&lt;role_name&gt;&amp;displayName=&lt;text_to_display&gt;
</pre></div>
</div>
<p>To switch back to your original user click on the coloured role button on the top right and choose ‘Back to &lt;username&gt;’.</p>
</div>
</div>
<div class="section" id="programmatic-access">
<h2><a class="toc-backref" href="#id15">Programmatic access</a><a class="headerlink" href="#programmatic-access" title="Permalink to this headline">¶</a></h2>
<div class="section" id="generating-access-keys">
<h3><a class="toc-backref" href="#id16">Generating access keys</a><a class="headerlink" href="#generating-access-keys" title="Permalink to this headline">¶</a></h3>
<p>You can generate access key the following way:</p>
<blockquote>
<div><ul class="simple">
<li><p>IAM -&gt; Users -&gt; [your user] -&gt; Security credentials tab -&gt; Create access key</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="storing-your-access-keys">
<h3><a class="toc-backref" href="#id17">Storing your access keys</a><a class="headerlink" href="#storing-your-access-keys" title="Permalink to this headline">¶</a></h3>
<p>For local use it’s recommend to save your keys to ~/.aws/credentials in the following format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">default</span><span class="p">]</span>
<span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">AKIAI</span><span class="o">...</span>
<span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">Kaet7Zae</span><span class="o">...</span>
</pre></div>
</div>
<p>Default credentials give you the permissions to use S3 development bucket when running apps locally and allow you to switch to different roles
depending on your user groups.</p>
</div>
<div class="section" id="available-roles">
<span id="aws-roles"></span><h3><a class="toc-backref" href="#id18">Available roles</a><a class="headerlink" href="#available-roles" title="Permalink to this headline">¶</a></h3>
<p>From <a class="reference external" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html">AWS documentation on IAM roles</a>:</p>
<blockquote>
<div><p>An IAM role is similar to a user, in that it is an AWS identity with permission policies that
determine what the identity can and cannot do in AWS. However, instead of being uniquely associated
with one person, a role is intended to be assumable by anyone who needs it. Also, a role does not
have any credentials (password or access keys) associated with it. Instead, if a user is assigned to
a role, access keys are created dynamically and provided to the user.</p>
</div></blockquote>
<p>Roles allow you to switch between different AWS accounts. 12-digit account number in the <cite>role_arn</cite> is
the target AWS account number the role is defined on.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 67%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Account name</p></td>
<td><p>Account number</p></td>
</tr>
<tr class="row-even"><td><p>digitalmarketplace</p></td>
<td><p>398263320410</p></td>
</tr>
<tr class="row-odd"><td><p>digitalmarketplace-development</p></td>
<td><p>381494870249</p></td>
</tr>
<tr class="row-even"><td><p>digitalmarketplace-production</p></td>
<td><p>050019655025</p></td>
</tr>
<tr class="row-odd"><td><p>digitalmarketplace-backups</p></td>
<td><p>796405775413</p></td>
</tr>
</tbody>
</table>
<p>If you need to switch to a different role you can define additional profiles in ~/.aws/config.</p>
<p><strong>SOPS credentials access</strong></p>
<p>This role has to be used for decrypting files in the digitalmarketplace-credentials repository.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">profile</span> <span class="n">sops</span><span class="p">]</span>
<span class="n">source_profile</span> <span class="o">=</span> <span class="n">default</span>
<span class="n">mfa_serial</span> <span class="o">=</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">iam</span><span class="p">::</span><span class="mi">398263320410</span><span class="p">:</span><span class="n">mfa</span><span class="o">/&lt;</span><span class="n">IAM</span> <span class="n">username</span><span class="o">&gt;</span>
<span class="n">role_arn</span> <span class="o">=</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">iam</span><span class="p">::</span><span class="mi">398263320410</span><span class="p">:</span><span class="n">role</span><span class="o">/</span><span class="n">sops</span><span class="o">-</span><span class="n">credentials</span><span class="o">-</span><span class="n">access</span>
</pre></div>
</div>
<p><strong>Infrastructure</strong></p>
<p>These roles are needed to run Terraform or CloudFormation scripts against main, development (preview) and production (staging and production) accounts.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">profile</span> <span class="n">development</span><span class="o">-</span><span class="n">infrastructure</span><span class="p">]</span>
<span class="n">source_profile</span> <span class="o">=</span> <span class="n">default</span>
<span class="n">mfa_serial</span> <span class="o">=</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">iam</span><span class="p">::</span><span class="mi">398263320410</span><span class="p">:</span><span class="n">mfa</span><span class="o">/&lt;</span><span class="n">IAM</span> <span class="n">username</span><span class="o">&gt;</span>
<span class="n">role_arn</span> <span class="o">=</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">iam</span><span class="p">::</span><span class="mi">381494870249</span><span class="p">:</span><span class="n">role</span><span class="o">/</span><span class="n">infrastructure</span>

<span class="p">[</span><span class="n">profile</span> <span class="n">production</span><span class="o">-</span><span class="n">infrastructure</span><span class="p">]</span>
<span class="n">source_profile</span> <span class="o">=</span> <span class="n">default</span>
<span class="n">mfa_serial</span> <span class="o">=</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">iam</span><span class="p">::</span><span class="mi">398263320410</span><span class="p">:</span><span class="n">mfa</span><span class="o">/&lt;</span><span class="n">IAM</span> <span class="n">username</span><span class="o">&gt;</span>
<span class="n">role_arn</span> <span class="o">=</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">iam</span><span class="p">::</span><span class="mi">050019655025</span><span class="p">:</span><span class="n">role</span><span class="o">/</span><span class="n">infrastructure</span>

<span class="p">[</span><span class="n">profile</span> <span class="n">main</span><span class="o">-</span><span class="n">infrastructure</span><span class="p">]</span>
<span class="n">source_profile</span> <span class="o">=</span> <span class="n">default</span>
<span class="n">mfa_serial</span> <span class="o">=</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">iam</span><span class="p">::</span><span class="mi">398263320410</span><span class="p">:</span><span class="n">mfa</span><span class="o">/&lt;</span><span class="n">IAM</span> <span class="n">username</span><span class="o">&gt;</span>
<span class="n">role_arn</span> <span class="o">=</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">iam</span><span class="p">::</span><span class="mi">398263320410</span><span class="p">:</span><span class="n">role</span><span class="o">/</span><span class="n">infrastructure</span>
</pre></div>
</div>
</div>
<div class="section" id="using-profiles">
<h3><a class="toc-backref" href="#id19">Using profiles</a><a class="headerlink" href="#using-profiles" title="Permalink to this headline">¶</a></h3>
<p>You may, and likely will, have several sets of AWS credentials that you use for different tasks.</p>
<blockquote>
<div><ul class="simple">
<li><p>Your <cite>sops</cite> credentials allow you to decrypt the files in the <cite>digitalmarketplace-credentials</cite> repo for example</p></li>
<li><p>Using the <cite>&lt;ENVIRONMENT&gt;-infrastructure</cite> roles will allow you to run terraform (see above)</p></li>
</ul>
</div></blockquote>
<p>Profiles are a way of grouping credentials and referring to them by name.</p>
<p>When using profiles you only need to set the <code class="docutils literal notranslate"><span class="pre">AWS_PROFILE</span></code> environment
variable for your command/ applications:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">AWS_PROFILE</span><span class="o">=</span><span class="n">somerole</span>
</pre></div>
</div>
<p>Some of the tools we use don’t have built-in support for assuming roles, so you
need to provide them with temporary credentials by prefixing the command with
<a class="reference external" href="https://github.com/alphagov/aws-auth">aws-auth</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aws</span><span class="o">-</span><span class="n">auth</span> <span class="o">&lt;</span><span class="n">command</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><strong>Examples</strong></p>
<p>Using SOPS to decode secrets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AWS_PROFILE</span><span class="o">=</span><span class="n">sops</span> <span class="n">aws</span><span class="o">-</span><span class="n">auth</span> <span class="n">sops</span> <span class="o">-</span><span class="n">d</span> <span class="n">logins</span><span class="o">.</span><span class="n">enc</span>
</pre></div>
</div>
<p>Running terraform (such as is done in the <a class="reference external" href="https://github.com/alphagov/digitalmarketplace-aws/blob/master/terraform/Makefile-common">digitalmarketplace-aws Makefile</a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AWS_PROFILE</span><span class="o">=</span><span class="n">development</span><span class="o">-</span><span class="n">infrastructure</span> <span class="n">aws</span><span class="o">-</span><span class="n">auth</span> <span class="n">terraform</span> <span class="n">get</span>
<span class="n">AWS_PROFILE</span><span class="o">=</span><span class="n">development</span><span class="o">-</span><span class="n">infrastructure</span> <span class="n">make</span> <span class="n">plan</span>
<span class="n">AWS_PROFILE</span><span class="o">=</span><span class="n">development</span><span class="o">-</span><span class="n">infrastructure</span> <span class="n">make</span> <span class="n">apply</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="billing-and-billing-alerts">
<h2><a class="toc-backref" href="#id20">Billing and billing alerts</a><a class="headerlink" href="#billing-and-billing-alerts" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://console.aws.amazon.com/cost-reports/home?#/custom?chartStyle=Stack&amp;groupBy=Service">AWS Cost Explorer</a> [<a class="reference external" href="http://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/cost-explorer-what-is.html">documentation</a>] is enabled for the admin role in the
main, development and production account.  This allows you to get cost reports
broken down in various ways.</p>
<p>There are <a class="reference external" href="https://console.aws.amazon.com/cloudwatch/home?region=us-east-1#alarmsV2:!alarmFilter=">billing alerts</a> [<a class="reference external" href="http://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/monitor-charges.html">documentation</a>] configured for the development
and production account where we might expect a greater degree of variance in
billing month to month.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="aws-resources.html" class="btn btn-neutral float-right" title="AWS Resources" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="antivirus.html" class="btn btn-neutral float-left" title="The Antivirus API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2013 - 2021 Digital Marketplace

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>