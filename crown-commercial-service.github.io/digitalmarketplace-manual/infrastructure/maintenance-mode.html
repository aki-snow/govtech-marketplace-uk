

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Maintenance Mode &mdash; digitalmarketplace-manual 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Python environments" href="python-environments.html" />
    <link rel="prev" title="Logging, monitoring and alerting" href="logging.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> digitalmarketplace-manual
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Digital Marketplace background</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../digital-marketplace-background/deportalising.html">History: From G-Cloud 5 to G-Cloud 8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../digital-marketplace-background/finding-things.html">Finding Things</a></li>
<li class="toctree-l1"><a class="reference internal" href="../digital-marketplace-background/journeys.html">User Journeys on the Digital Marketplace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../digital-marketplace-background/gdpr.html">GDPR</a></li>
</ul>
<p class="caption"><span class="caption-text">Developing the Digital Marketplace</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/accessing-the-api.html">Accessing the API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/adding-repos.html">Adding a new repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/application-architecture.html">Application architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/browser-support.html">Browser and accessibility support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/environments.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/developer-setup.html">Developer setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/decision-records.html">Recording decisions on the Digital Marketplace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/digitalmarketplace-runner.html">Digital Marketplace Runner (‘dmrunner’)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/nix.html">Nix Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/data-model.html">Data model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/development-and-deployment-process.html">Development and deployment process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/frontend-migration.html">Migrating the Digital Marketplace frontend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/moving-data.html">Moving data between environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/urls.html">URLs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/users.html">Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/google-analytics.html">Google Analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/load-testing.html">Load testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/automated-testing.html">Automated testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/splitting-applications.html">Splitting or adding a frontend application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/database-migrations.html">Database migrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/docker-strategies.html">Docker strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/frontend-assets-and-tools.html">Frontend assets and tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/python-typing-strategy.html">Python typing strategy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing-the-digital-marketplace/production-guidelines.html">Guidelines for accessing production data and systems</a></li>
</ul>
<p class="caption"><span class="caption-text">Content and frameworks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/adding-frameworks.html">Preparing to add a new framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/framework-lifecycle-for-developers.html">Framework lifecycle for developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/how-suppliers-apply-to-a-framework.html">How suppliers apply to a framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/framework-agreements.html">Framework agreements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/contract-variations.html">Contract variations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/adding-a-new-form-field-type.html">Adding a new form field type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/finding-content.html">Finding content</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/changing-content.html">Changing content</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/useful-api-endpoints-for-frameworks.html">Useful API endpoints for frameworks</a></li>
</ul>
<p class="caption"><span class="caption-text">Infrastructure</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="antivirus.html">The Antivirus API</a></li>
<li class="toctree-l1"><a class="reference internal" href="aws-accounts.html">AWS accounts and access</a></li>
<li class="toctree-l1"><a class="reference internal" href="aws-resources.html">AWS Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-backups.html">Code backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="database-backups.html">Database backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="domains.html">Domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="emails.html">Email integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="elasticsearch.html">Elasticsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="jenkins.html">Jenkins</a></li>
<li class="toctree-l1"><a class="reference internal" href="github-actions.html">GitHub Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging, monitoring and alerting</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Maintenance Mode</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#planned-downtime">Planned downtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="#accessing-applications-during-maintenance">Accessing applications during maintenance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-activate-deactivate">How to activate/deactivate</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#automatically-activating-deactivating-maintenance-mode">Automatically activating/deactivating maintenance mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#manually-activating-deactivating-maintenance-mode">Manually activating/deactivating maintenance mode</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#activate">Activate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deactivate">Deactivate</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#what-does-it-look-like">What does it look like?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-going-on-under-the-hood">What’s going on under the hood?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lack-of-sticky-sessions">Lack of sticky sessions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="python-environments.html">Python environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="paas.html">What is PaaS?</a></li>
<li class="toctree-l1"><a class="reference internal" href="paas.html#deploying-digital-marketplace-apps-to-gov-uk-paas">Deploying Digital Marketplace apps to GOV.UK PaaS</a></li>
<li class="toctree-l1"><a class="reference internal" href="rate-limiting.html">Rate Limiting</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrading-backend-services.html">Upgrading backend services</a></li>
<li class="toctree-l1"><a class="reference internal" href="session-management.html">Session Management</a></li>
</ul>
<p class="caption"><span class="caption-text">Managing People and Secret Things</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../managing-people-and-secret-things/credentials.html">Credentials and secrets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../managing-people-and-secret-things/accounts.html">Adding and removing access for new starters / leavers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../managing-people-and-secret-things/production-access.html">Requirements for access to production environments</a></li>
</ul>
<p class="caption"><span class="caption-text">2nd Line Runbook</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/incidents.html">Incidents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/logging-in-to-paas-databases.html">Logging in to databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/logging-in-to-paas-databases.html#resetting-brief-data-with-conduit">Resetting brief data with conduit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/blocking-ips.html">IP Restrictions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/upgrading-jenkins.html">Upgrading Jenkins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/rebuilding-jenkins.html">Rebuilding Jenkins from scratch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/rotate-keys.html">Rotating API keys</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/debugging-paas-app-instances.html">Debugging PaaS App Instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/vulnerability-scanning.html">Vulnerability scanning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/novations.html">Novations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/support-tasks.html">Support Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/investigating-alerts.html">Responding to Cloudwatch alerts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/buyer-domain-allow-list.html">Buyer Domain Allow List</a></li>
</ul>
<p class="caption"><span class="caption-text">What is this?</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/alphagov/digitalmarketplace-manual/blob/master/README.md">README</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">digitalmarketplace-manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Maintenance Mode</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/Crown-Commercial-Service/digitalmarketplace-manual/blob/main/manual/infrastructure/maintenance-mode.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="maintenance-mode">
<span id="id1"></span><h1><a class="toc-backref" href="#id2">Maintenance Mode</a><a class="headerlink" href="#maintenance-mode" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#maintenance-mode" id="id2">Maintenance Mode</a></p>
<ul>
<li><p><a class="reference internal" href="#planned-downtime" id="id3">Planned downtime</a></p></li>
<li><p><a class="reference internal" href="#accessing-applications-during-maintenance" id="id4">Accessing applications during maintenance</a></p></li>
<li><p><a class="reference internal" href="#how-to-activate-deactivate" id="id5">How to activate/deactivate</a></p>
<ul>
<li><p><a class="reference internal" href="#automatically-activating-deactivating-maintenance-mode" id="id6">Automatically activating/deactivating maintenance mode</a></p></li>
<li><p><a class="reference internal" href="#manually-activating-deactivating-maintenance-mode" id="id7">Manually activating/deactivating maintenance mode</a></p>
<ul>
<li><p><a class="reference internal" href="#activate" id="id8">Activate</a></p></li>
<li><p><a class="reference internal" href="#deactivate" id="id9">Deactivate</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#what-does-it-look-like" id="id10">What does it look like?</a></p></li>
<li><p><a class="reference internal" href="#what-s-going-on-under-the-hood" id="id11">What’s going on under the hood?</a></p></li>
<li><p><a class="reference internal" href="#lack-of-sticky-sessions" id="id12">Lack of sticky sessions</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="planned-downtime">
<h2><a class="toc-backref" href="#id3">Planned downtime</a><a class="headerlink" href="#planned-downtime" title="Permalink to this headline">¶</a></h2>
<p>Sometimes we need planned downtime, for example when doing a <a class="reference internal" href="database-backups.html#database-restore"><span class="std std-ref">database restore</span></a>.</p>
<p>The goal is to stop users accessing the site, preventing them from seeing incorrect information or making changes that
may be lost.</p>
<p>To do this we put the Digital Marketplace into ‘maintenance mode’. In this mode, any visitor to the Digital
Marketplace will be served a static html page informing them of this down time.</p>
<p>Maintenance mode was first used in 2017 when we moved our underlying infrastructure from ElasticBeanstalk to the PaaS.</p>
</div>
<div class="section" id="accessing-applications-during-maintenance">
<h2><a class="toc-backref" href="#id4">Accessing applications during maintenance</a><a class="headerlink" href="#accessing-applications-during-maintenance" title="Permalink to this headline">¶</a></h2>
<p>When maintenance mode is active, no-one is able to access our applications via their normal domains (preview.marketplace.team,
staging.marketplace.team, and digitalmarketplace.service.gov.uk). Users see a static page served by the router app.</p>
<p>We also have a ‘recovery’ mode that allows developers access to the API apps, while still blocking user access to the
Frontend apps. Recovery mode allows scripts such as the Jenkins re-indexing jobs to access the APIs in the normal way.</p>
<p>Developers can also bypass the router, accessing the apps via the Cloud Foundry/PaaS ‘internal’ domain,
<code class="docutils literal notranslate"><span class="pre">cloudapps.digital</span></code>.</p>
<p>Note that the frontend applications are hosted at <code class="docutils literal notranslate"><span class="pre">dm-&lt;stage&gt;.cloudapps.digital</span></code> with their specific path
suffixes, and are protected by an extra level of Basic Auth which will need to be supplied when accessed
through this method (see the <a class="reference external" href="https://github.com/alphagov/digitalmarketplace-credentials/">credentials repo</a>).</p>
</div>
<div class="section" id="how-to-activate-deactivate">
<h2><a class="toc-backref" href="#id5">How to activate/deactivate</a><a class="headerlink" href="#how-to-activate-deactivate" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to activate maintenance mode:</p>
<ol class="arabic simple">
<li><p>With the Jenkins job <code class="docutils literal notranslate"><span class="pre">Toggle</span> <span class="pre">maintenance</span> <span class="pre">mode</span></code></p></li>
<li><p>Manually deploying a new version of the PaaS router application.</p></li>
</ol>
<div class="section" id="automatically-activating-deactivating-maintenance-mode">
<h3><a class="toc-backref" href="#id6">Automatically activating/deactivating maintenance mode</a><a class="headerlink" href="#automatically-activating-deactivating-maintenance-mode" title="Permalink to this headline">¶</a></h3>
<p>This is the preferred way to enable or disable maintenance mode and should be used in all cases where our infrastructure
is running under normal conditions.</p>
<ol class="arabic simple">
<li><p>Start a new build of the pipeline job <code class="docutils literal notranslate"><span class="pre">Toggle</span> <span class="pre">maintenance</span> <span class="pre">mode</span></code> on <code class="docutils literal notranslate"><span class="pre">ci.marketplace.team</span></code>. Select the appropriate
target stage (preview, staging, production) and mode (maintenance, recovery or live).</p></li>
<li><p>Once the build has started, a new Pull Request will be generated against the <code class="docutils literal notranslate"><span class="pre">digitalmarketplace-aws</span></code> repository.
Review, approve, and merge this to master.</p></li>
<li><p>After it has been merged to master, continue the Pipeline job in Jenkins by clicking ‘Proceed’ on the two input
boxes on the current Pipeline stage.</p></li>
</ol>
</div>
<div class="section" id="manually-activating-deactivating-maintenance-mode">
<h3><a class="toc-backref" href="#id7">Manually activating/deactivating maintenance mode</a><a class="headerlink" href="#manually-activating-deactivating-maintenance-mode" title="Permalink to this headline">¶</a></h3>
<p>You should only need to manually deploy maintenance mode if some part of our infrastructure and deployment pipeline has failed,
for example, Jenkins or Github are down.</p>
<div class="section" id="activate">
<h4><a class="toc-backref" href="#id8">Activate</a><a class="headerlink" href="#activate" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p>Update the target stage’s variables file that is used in our PaaS manifests - <code class="docutils literal notranslate"><span class="pre">https://github.com/alphagov/digitalmarketplace-aws/blob/master/vars/&lt;preview|staging|production&gt;.yml</span></code>.
To turn maintenance mode on, set <code class="docutils literal notranslate"><span class="pre">maintenance_mode:</span> <span class="pre">maintenance</span></code>.</p></li>
<li><p>You will need access to the PaaS space you wish to deploy to (likely production). You will need to
<a class="reference internal" href="paas.html#paas"><span class="std std-ref">deploy a new dockerised app</span></a>. To deploy the router, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">STAGE</span><span class="o">=</span><span class="n">production</span> <span class="n">APPLICATION_NAME</span><span class="o">=</span><span class="n">router</span> <span class="n">RELEASE_NAME</span><span class="o">=&lt;</span><span class="n">release_tag</span><span class="o">&gt;</span> <span class="n">make</span> <span class="n">deploy</span><span class="o">-</span><span class="n">app</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">release_tag</span></code> is of the format <code class="docutils literal notranslate"><span class="pre">release-###</span></code> and can be discovered by using <code class="docutils literal notranslate"><span class="pre">cf</span> <span class="pre">app</span> <span class="pre">router</span></code> and looking at the
currently-deployed app’s docker image, which looks something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">image</span><span class="p">:</span>      <span class="n">digitalmarketplace</span><span class="o">/</span><span class="n">router</span><span class="p">:</span><span class="n">release</span><span class="o">-</span><span class="mi">18</span>
</pre></div>
</div>
</li>
<li><p>The release should only take a few minutes. After the release has completed, maintenance mode will be enabled.</p></li>
</ol>
</div>
<div class="section" id="deactivate">
<h4><a class="toc-backref" href="#id9">Deactivate</a><a class="headerlink" href="#deactivate" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>The process is the same as activation. However set <code class="docutils literal notranslate"><span class="pre">maintenance_mode:</span> <span class="pre">live</span></code>.</p></li>
</ol>
</div>
</div>
</div>
<div class="section" id="what-does-it-look-like">
<h2><a class="toc-backref" href="#id10">What does it look like?</a><a class="headerlink" href="#what-does-it-look-like" title="Permalink to this headline">¶</a></h2>
<img alt="../_images/maintenance-mode.png" src="../_images/maintenance-mode.png" />
</div>
<div class="section" id="what-s-going-on-under-the-hood">
<h2><a class="toc-backref" href="#id11">What’s going on under the hood?</a><a class="headerlink" href="#what-s-going-on-under-the-hood" title="Permalink to this headline">¶</a></h2>
<p>Setting <code class="docutils literal notranslate"><span class="pre">DM_MODE</span></code> on the manifest will pass it as an environment variable to the router app.</p>
<p>There are three modes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DM_MODE</span> <span class="pre">=</span> <span class="pre">'maintenance'</span></code>: healthcheck and metrics endpoints for the router only, all other routes will be directed
to a static maintenance page (served by the router) and return a 503 status code.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DM_MODE</span> <span class="pre">=</span> <span class="pre">'recovery'</span></code>: healthcheck and metrics endpoints for the router only, plus API apps. All other routes will
be directed to a static maintenance page.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DM_MODE</span> <span class="pre">=</span> <span class="pre">'live'</span></code>: all apps served as normal</p></li>
</ul>
<p>This is achieved by changing which config files are loaded by the router based on the <code class="docutils literal notranslate"><span class="pre">DM_MODE</span></code> environment variable.
See the <a class="reference external" href="https://github.com/alphagov/digitalmarketplace-router/blob/master/nginx.sh#L6">nginx start up script in the router app</a> for details.</p>
</div>
<div class="section" id="lack-of-sticky-sessions">
<h2><a class="toc-backref" href="#id12">Lack of sticky sessions</a><a class="headerlink" href="#lack-of-sticky-sessions" title="Permalink to this headline">¶</a></h2>
<p>Before we moved our routing to the PaaS, our traffic used to come through Amazon Elastic Load Balancers (ELBs). This enabled us
to use “sticky sessions” on the ELB to ensure that a user receives a consistent experience when the maintenance page is turned on.
We no longer have this ability. This means that if you turn on maintenance mode, there will be a short period of time where both
the old and new router instances are healthy and serving requests. If a user initially hits the old router app and is served the
html for the homepage, they may receive a 503 when trying to load CSS or Javascript if the request is routed to the new router app.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="python-environments.html" class="btn btn-neutral float-right" title="Python environments" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="logging.html" class="btn btn-neutral float-left" title="Logging, monitoring and alerting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2013 - 2021 Digital Marketplace

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>