

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Splitting or adding a frontend application &mdash; digitalmarketplace-manual 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Database migrations" href="database-migrations.html" />
    <link rel="prev" title="Automated testing" href="automated-testing.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> digitalmarketplace-manual
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Digital Marketplace background</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../digital-marketplace-background/deportalising.html">History: From G-Cloud 5 to G-Cloud 8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../digital-marketplace-background/finding-things.html">Finding Things</a></li>
<li class="toctree-l1"><a class="reference internal" href="../digital-marketplace-background/journeys.html">User Journeys on the Digital Marketplace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../digital-marketplace-background/gdpr.html">GDPR</a></li>
</ul>
<p class="caption"><span class="caption-text">Developing the Digital Marketplace</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="accessing-the-api.html">Accessing the API</a></li>
<li class="toctree-l1"><a class="reference internal" href="adding-repos.html">Adding a new repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="application-architecture.html">Application architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="browser-support.html">Browser and accessibility support</a></li>
<li class="toctree-l1"><a class="reference internal" href="environments.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer-setup.html">Developer setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="decision-records.html">Recording decisions on the Digital Marketplace</a></li>
<li class="toctree-l1"><a class="reference internal" href="digitalmarketplace-runner.html">Digital Marketplace Runner (‘dmrunner’)</a></li>
<li class="toctree-l1"><a class="reference internal" href="nix.html">Nix Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-model.html">Data model</a></li>
<li class="toctree-l1"><a class="reference internal" href="development-and-deployment-process.html">Development and deployment process</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontend-migration.html">Migrating the Digital Marketplace frontend</a></li>
<li class="toctree-l1"><a class="reference internal" href="moving-data.html">Moving data between environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="urls.html">URLs</a></li>
<li class="toctree-l1"><a class="reference internal" href="users.html">Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="google-analytics.html">Google Analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="load-testing.html">Load testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="automated-testing.html">Automated testing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Splitting or adding a frontend application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-infrastructure">Setting up infrastructure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-a-repo">Setting up a repo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-a-release-pipeline">Setting up a release pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-paas-and-aws-environment">Setting up PaaS and AWS environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-a-local-environment">Setting up a local environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#first-deployment">First deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subdomains">Subdomains</a></li>
<li class="toctree-l3"><a class="reference internal" href="#smoke-tests">Smoke tests</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="database-migrations.html">Database migrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker-strategies.html">Docker strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="frontend-assets-and-tools.html">Frontend assets and tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="python-typing-strategy.html">Python typing strategy</a></li>
<li class="toctree-l1"><a class="reference internal" href="production-guidelines.html">Guidelines for accessing production data and systems</a></li>
</ul>
<p class="caption"><span class="caption-text">Content and frameworks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/adding-frameworks.html">Preparing to add a new framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/framework-lifecycle-for-developers.html">Framework lifecycle for developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/how-suppliers-apply-to-a-framework.html">How suppliers apply to a framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/framework-agreements.html">Framework agreements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/contract-variations.html">Contract variations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/adding-a-new-form-field-type.html">Adding a new form field type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/finding-content.html">Finding content</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/changing-content.html">Changing content</a></li>
<li class="toctree-l1"><a class="reference internal" href="../content-and-frameworks/useful-api-endpoints-for-frameworks.html">Useful API endpoints for frameworks</a></li>
</ul>
<p class="caption"><span class="caption-text">Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/antivirus.html">The Antivirus API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/aws-accounts.html">AWS accounts and access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/aws-resources.html">AWS Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/code-backups.html">Code backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/database-backups.html">Database backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/domains.html">Domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/emails.html">Email integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/elasticsearch.html">Elasticsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/jenkins.html">Jenkins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/github-actions.html">GitHub Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/logging.html">Logging, monitoring and alerting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/maintenance-mode.html">Maintenance Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/python-environments.html">Python environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/paas.html">What is PaaS?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/paas.html#deploying-digital-marketplace-apps-to-gov-uk-paas">Deploying Digital Marketplace apps to GOV.UK PaaS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/rate-limiting.html">Rate Limiting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/upgrading-backend-services.html">Upgrading backend services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/session-management.html">Session Management</a></li>
</ul>
<p class="caption"><span class="caption-text">Managing People and Secret Things</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../managing-people-and-secret-things/credentials.html">Credentials and secrets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../managing-people-and-secret-things/accounts.html">Adding and removing access for new starters / leavers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../managing-people-and-secret-things/production-access.html">Requirements for access to production environments</a></li>
</ul>
<p class="caption"><span class="caption-text">2nd Line Runbook</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/incidents.html">Incidents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/logging-in-to-paas-databases.html">Logging in to databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/logging-in-to-paas-databases.html#resetting-brief-data-with-conduit">Resetting brief data with conduit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/blocking-ips.html">IP Restrictions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/upgrading-jenkins.html">Upgrading Jenkins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/rebuilding-jenkins.html">Rebuilding Jenkins from scratch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/rotate-keys.html">Rotating API keys</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/debugging-paas-app-instances.html">Debugging PaaS App Instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/vulnerability-scanning.html">Vulnerability scanning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/novations.html">Novations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/support-tasks.html">Support Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/investigating-alerts.html">Responding to Cloudwatch alerts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2nd-line-runbook/buyer-domain-allow-list.html">Buyer Domain Allow List</a></li>
</ul>
<p class="caption"><span class="caption-text">What is this?</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/alphagov/digitalmarketplace-manual/blob/master/README.md">README</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">digitalmarketplace-manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Splitting or adding a frontend application</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/Crown-Commercial-Service/digitalmarketplace-manual/blob/main/manual/developing-the-digital-marketplace/splitting-applications.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="splitting-or-adding-a-frontend-application">
<h1><a class="toc-backref" href="#id2">Splitting or adding a frontend application</a><a class="headerlink" href="#splitting-or-adding-a-frontend-application" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#splitting-or-adding-a-frontend-application" id="id2">Splitting or adding a frontend application</a></p>
<ul>
<li><p><a class="reference internal" href="#prerequisites" id="id3">Prerequisites</a></p></li>
<li><p><a class="reference internal" href="#setting-up-infrastructure" id="id4">Setting up infrastructure</a></p>
<ul>
<li><p><a class="reference internal" href="#setting-up-a-repo" id="id5">Setting up a repo</a></p></li>
<li><p><a class="reference internal" href="#setting-up-a-release-pipeline" id="id6">Setting up a release pipeline</a></p></li>
<li><p><a class="reference internal" href="#setting-up-paas-and-aws-environment" id="id7">Setting up PaaS and AWS environment</a></p></li>
<li><p><a class="reference internal" href="#setting-up-a-local-environment" id="id8">Setting up a local environment</a></p></li>
<li><p><a class="reference internal" href="#first-deployment" id="id9">First deployment</a></p></li>
<li><p><a class="reference internal" href="#subdomains" id="id10">Subdomains</a></p></li>
<li><p><a class="reference internal" href="#smoke-tests" id="id11">Smoke tests</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Introducing a new application will increase the amount of maintenance for the dev team. Make sure the team has discussed and agreed whether a new app is really necessary before following the steps below.</p>
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id3">Prerequisites</a><a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Each new frontend application needs to meet some common requirements:</p>
<ul class="simple">
<li><p>All routes have a shared prefix that is not used by any other frontend app (eg <code class="docutils literal notranslate"><span class="pre">/suppliers</span></code> or <code class="docutils literal notranslate"><span class="pre">/opportunities</span></code>).
The best way to ensure this is to use a Blueprint with a <code class="docutils literal notranslate"><span class="pre">url_prefix='/...'</span></code> argument.</p></li>
<li><p>Make sure links to application static files start with <code class="docutils literal notranslate"><span class="pre">/&lt;prefix&gt;/static</span></code>.
This is usually done by setting Flask static URL path with
<code class="docutils literal notranslate"><span class="pre">Flask(...,</span> <span class="pre">static_url_path=configs[config_name].STATIC_URL_PATH)</span></code> in <code class="docutils literal notranslate"><span class="pre">app/__init__.py</span></code>
and adding <code class="docutils literal notranslate"><span class="pre">STATIC_URL_PATH</span> <span class="pre">=</span> <span class="pre">'/&lt;prefix&gt;/static'</span></code> and <code class="docutils literal notranslate"><span class="pre">ASSET_PATH</span> <span class="pre">=</span> <span class="pre">STATIC_URL_PATH</span> <span class="pre">+</span> <span class="pre">'/'</span></code>
to <code class="docutils literal notranslate"><span class="pre">config.py</span></code>.</p></li>
<li><p>Application has a status endpoint at <code class="docutils literal notranslate"><span class="pre">/&lt;prefix&gt;/_status</span></code></p></li>
<li><p>Application uses a unique port when running locally with a dev server (eg 5000, 5001, … used by existing apps)</p></li>
</ul>
</div>
<div class="section" id="setting-up-infrastructure">
<h2><a class="toc-backref" href="#id4">Setting up infrastructure</a><a class="headerlink" href="#setting-up-infrastructure" title="Permalink to this headline">¶</a></h2>
<div class="section" id="setting-up-a-repo">
<h3><a class="toc-backref" href="#id5">Setting up a repo</a><a class="headerlink" href="#setting-up-a-repo" title="Permalink to this headline">¶</a></h3>
<p>Follow the steps in <a class="reference internal" href="adding-repos.html#adding-repos"><span class="std std-ref">Adding a new repository</span></a> to create a GitHub repository for the
new app. The repo name should follow the <code class="docutils literal notranslate"><span class="pre">digitalmarketplace-&lt;application-name&gt;</span></code> pattern.</p>
</div>
<div class="section" id="setting-up-a-release-pipeline">
<h3><a class="toc-backref" href="#id6">Setting up a release pipeline</a><a class="headerlink" href="#setting-up-a-release-pipeline" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Add application name to the list in the Jenkins <code class="docutils literal notranslate"><span class="pre">dm_application</span></code> variable.</p></li>
<li><p>Add application jobs to the relevant Jenkins job views (eg add <code class="docutils literal notranslate"><span class="pre">release-&lt;application</span> <span class="pre">name&gt;</span></code> to the Release jobs list).</p></li>
<li><p>Apply changes to the Jenkins jobs and config.</p></li>
</ol>
</div>
<div class="section" id="setting-up-paas-and-aws-environment">
<h3><a class="toc-backref" href="#id7">Setting up PaaS and AWS environment</a><a class="headerlink" href="#setting-up-paas-and-aws-environment" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Add the application name to the <strong>end</strong> of the list in Terraform <code class="docutils literal notranslate"><span class="pre">app_names</span></code> variable (in <code class="docutils literal notranslate"><span class="pre">modules/application-logs</span></code>).</p></li>
<li><p><a class="reference external" href="https://github.com/alphagov/digitalmarketplace-aws/blob/master/terraform/README.md">Apply Terraform changes</a> to all
environments to create CloudWatch log groups and set up log streaming for the new app.</p></li>
<li><p>Define application variables in the <code class="docutils literal notranslate"><span class="pre">digitalmarketplace-aws/vars/common.yml</span></code> file. For most apps the only things you’ll
need are the <code class="docutils literal notranslate"><span class="pre">subdomain</span></code> and <code class="docutils literal notranslate"><span class="pre">path</span></code> (the common route prefix) for the new app.</p></li>
<li><p>Create a manifest file in <code class="docutils literal notranslate"><span class="pre">digitalmarketplace-aws/paas</span></code> with the name of the app.</p></li>
</ol>
</div>
<div class="section" id="setting-up-a-local-environment">
<h3><a class="toc-backref" href="#id8">Setting up a local environment</a><a class="headerlink" href="#setting-up-a-local-environment" title="Permalink to this headline">¶</a></h3>
<p>Add the app to <a class="reference external" href="https://github.com/alphagov/digitalmarketplace-runner">digitalmarketplace-runner</a> so that devs can
run the app locally.</p>
</div>
<div class="section" id="first-deployment">
<h3><a class="toc-backref" href="#id9">First deployment</a><a class="headerlink" href="#first-deployment" title="Permalink to this headline">¶</a></h3>
<p>At this point you should be able to run the new Jenkins release job (<code class="docutils literal notranslate"><span class="pre">[Pipeline]</span> <span class="pre">&lt;application</span> <span class="pre">name&gt;</span></code>) to deploy the app to the preview environment. You can do
this by either running the job manually or merging a PR.</p>
<p>If the application is being split from an existing app then any new requests for the prefixed routes will be handled by the
new app.</p>
<p>Once the app is deployed you should check that:</p>
<ul class="simple">
<li><p>App is responding to health checks and status endpoint requests as expected</p></li>
<li><p>Functional tests are passing</p></li>
<li><p>Logs are being streamed to CloudWatch and Kibana</p></li>
<li><p>App functionality that requires specific environment variables to be set is working as expected</p></li>
</ul>
<p>Once you’ve confirmed that the app is working as intended you can deploy it to staging and production and remove the routes
from the old application.</p>
<p>Once the app is deployed to production for the first time you can add it to the list of apps in the team’s Deploy Lag Radiator.</p>
<p>You should add a <a class="reference internal" href="../infrastructure/logging.html#alerting"><span class="std std-ref">Pingdom</span></a> healthcheck to the app.</p>
</div>
<div class="section" id="subdomains">
<h3><a class="toc-backref" href="#id10">Subdomains</a><a class="headerlink" href="#subdomains" title="Permalink to this headline">¶</a></h3>
<p>The new PaaS app should be automatically assigned a <code class="docutils literal notranslate"><span class="pre">*.cloudapps.digital</span></code> domain which is mostly intended for internal
access but should also be accessible from external IP addresses. New apps that require a publicly accessible subdomain (e.g.
for receiving callbacks from external services) should have these requests handled and delegated through the router app
so that all regular inbound requests get similar treatment (access control, logging, tracing, sampling behaviour). A
few steps will need to be followed for setting up the new subdomain.</p>
<ol class="arabic simple">
<li><p>Add a new env var to the <a class="reference external" href="https://github.com/alphagov/digitalmarketplace-aws/blob/master/paas/router.j2">router app’s paas manifest template</a>
pointing to the new app’s <code class="docutils literal notranslate"><span class="pre">*.cloudapps.digital</span></code> domain.</p></li>
<li><p>Add a new <code class="docutils literal notranslate"><span class="pre">server</span> <span class="pre">{</span> <span class="pre">...</span></code> section to the <a class="reference external" href="https://github.com/alphagov/digitalmarketplace-router/tree/master/templates">router app’s nginx configuration</a>.
This can probably be  cloned from the most similar existing app’s section and adapted to needs, but should restrict
itself to <code class="docutils literal notranslate"><span class="pre">server_name</span> <span class="pre">new-app-name.*;</span></code> and make any access restrictions it wants to place on its exposed routes.
The template should get fed a variable based on the env var previously set in the <a class="reference external" href="https://github.com/alphagov/digitalmarketplace-aws/blob/master/paas/router.j2">manifest</a>.
This should be used to tell <code class="docutils literal notranslate"><span class="pre">proxy_pass</span></code> where to direct the new subdomain’s traffic.</p></li>
<li><p>Add the subdomain’s DNS record by giving it a section in our <a class="reference external" href="https://github.com/alphagov/digitalmarketplace-aws/blob/master/terraform/modules/router/route53.tf">terraform config for route53</a>. Again, this will
probably be extremely similar to its sibling entries in that file. <code class="docutils literal notranslate"><span class="pre">plan</span></code> and <code class="docutils literal notranslate"><span class="pre">apply</span></code> the changes for each
environment.</p></li>
<li><p>Add the new subdomains to the router’s <code class="docutils literal notranslate"><span class="pre">routes:</span></code> <a class="reference external" href="https://github.com/alphagov/digitalmarketplace-aws/blob/master/vars/">“vars”</a>
so this is picked up when generating the router’s paas manifest.</p></li>
<li><p>Add the new subdomain to the <code class="docutils literal notranslate"><span class="pre">CDN_ROUTE_SERVICE_CONF</span></code> setting in <a class="reference external" href="https://github.com/alphagov/digitalmarketplace-router/blob/master/Makefile">digitalmarketplace-router’s Makefile</a>’s
and run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">update-cdn-route-service</span></code> for each environment’s domains.
There are a number of other more minor places the subdomains are enumerated in the router app, at time of writing
the <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test-nginx</span></code> <a class="reference external" href="https://github.com/alphagov/digitalmarketplace-router/blob/master/Makefile">docker command</a>,
the <a class="reference external" href="https://github.com/alphagov/digitalmarketplace-router/blob/master/README.md">README</a>,
<a class="reference external" href="https://github.com/alphagov/digitalmarketplace-router/blob/master/README.md">docker-compose.yml.example</a>. These
should be updated too.</p></li>
</ol>
</div>
<div class="section" id="smoke-tests">
<h3><a class="toc-backref" href="#id11">Smoke tests</a><a class="headerlink" href="#smoke-tests" title="Permalink to this headline">¶</a></h3>
<p>Add a check of the app’s <code class="docutils literal notranslate"><span class="pre">/_status</span></code> endpoint to the
<a class="reference external" href="https://github.com/alphagov/digitalmarketplace-functional-tests/blob/master/features/smoke-tests/apps_status.feature">smoke tests</a>. Unless the app is a frontend, this will require propagating the new app’s domain through
the functional tests’ <a class="reference external" href="https://github.com/alphagov/digitalmarketplace-functional-tests/blob/master/features/support/env.rb">env</a> and jenkins’
<a class="reference external" href="https://github.com/alphagov/digitalmarketplace-jenkins/blob/main/playbooks/roles/jenkins/defaults/main.yml">ansible vars</a>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="database-migrations.html" class="btn btn-neutral float-right" title="Database migrations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="automated-testing.html" class="btn btn-neutral float-left" title="Automated testing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2013 - 2021 Digital Marketplace

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>